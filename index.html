<html>
<head>


<script async src="https://securepubads.g.doubleclick.net/tag/js/gpt.js"></script>
<script>
    window.googletag = window.googletag || {cmd: []};
</script>
<script>
googletag.cmd.push(function() {
  // Infinite scroll requires SRA
  googletag.pubads().enableSingleRequest();
  googletag.pubads().collapseEmptyDivs(true);
  // Disable initial load, we will use refresh() to fetch ads.
  // Calling this function means that display() calls just
  // register the slot as ready, but do not fetch ads for it.
  googletag.pubads().disableInitialLoad();

  // Enable services
  googletag.enableServices();
  // Declare any slots initially present on the page
});
</script>
</head>
<body>
<style>
div {
    border:1px solid #333;
    margin:20px;
    padding: 10px;
}
</style>
<script>
  var adHandler = window.adHandler||{};
  adHandler.cmd = adHandler.cmd||[];
  /*adHandler.cmd.push(function(){
    console.log('first call');
  });
  adHandler.cmd.push(function(){
    console.log('second call');
  });*/
  document.addEventListener('adHandlerReady', function(e){
    console.log('adhandler ready', e);
    //adHandler.init();
  });
  setTimeout(function(){
    /*adHandler.cmd.push(function(){
      //console.log('with timeout');
    });
    document.addEventListener('adHandlerReady', function(e){
      console.log('ready222', e);
    });*/
    //console.log('slot count', adHandler.slotRepository.getCount())
  },1000);


</script>
<!--<script data-main="dist/index" src="./require.js"></script>-->
<script src="dist/adhandler.bundle.js"></script>
<script>
adHandler.cmd.push(function(){
  adHandler.setContext({'url':'article1'});
});
</script>
<style>
.sticky-div{
  width:320px;
  position: fixed;
  top: 0;
  right: 20px;
  margin:0;
  padding:0;
  /*background: green;*/
}

.sticky-div div{
  margin:0;
  padding: 0;
}
</style>
<div id="sticky-div" class="sticky-div">
<script>
adHandler.cmd.push(function(){
  adHandler.displaySlot(
    adHandler.devices.All,
      '/11060405/MR_Mobile_End_of_Article',
      ['fluid', [320, 50], [300, 250], [320, 100], [300, 50]],
      'sticky-div',
  );
});
</script>
</div>
<p>&nbsp;</p>
<!-- Simplified URL AdSlot 1 for Ad Unit '/MR_Mobile_End_of_Article' ### Size: 300x250|320x50|320x100|300x50 -->
<!--<a href='https://pubads.g.doubleclick.net/gampad/jump?iu=/11060405/MR_Mobile_End_of_Article&sz=300x250|320x50|320x100|300x50&c=1572623555'>
  <img src='https://pubads.g.doubleclick.net/gampad/ad?iu=/11060405/MR_Mobile_End_of_Article&sz=300x250|320x50|320x100|300x50&c=1572623555'/>
</a>-->
<!-- End -->

<!--<iframe src="http://localhost:3000" width="400" height="250"></iframe>-->
<p id="if-container">&nbsp;</p>
<p>&nbsp;</p>
<!--<p>&nbsp;</p>
<p>&nbsp;</p>-->
<p>&nbsp;</p>
<p>&nbsp;</p>
<div id="test3">
<script>


adHandler.cmd.push(function(){
  adHandler.displaySlot(
    adHandler.devices.All,
      '/11060405/MR_Mobile_End_of_Article',
      ['fluid', [320, 50], [300, 250], [320, 100], [300, 50]],
      'test3',
      {isLazy: true, onViewed: function(){
        console.log('****viewed***');
      }}
  );
});
</script>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<div id="test4">
    <script>
      adHandler.cmd.push(function(){
        //console.log('****** END OF ARTICLE ********');
        adHandler.displaySlot(
          adHandler.devices.All,
            '/11060405/MR_Mobile_End_of_Article',
            ['fluid', [320, 50], [300, 250], [320, 100], [300, 50]],
            'test4',
            {isLazy: true}
        );
      });
    </script>
  </div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>

<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<hr id="changectx">
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<div id="test1">test1</div>
<div id="test2">

  <script>
      adHandler.cmd.push(function(){
        adHandler.displaySlot(
          adHandler.devices.All,
          '/11060405/MR_Mobile_End_of_Article',
          ['fluid', [320, 50], [300, 250], [320, 100], [300, 50]],
          'test2',
          {isLazy: true}
        );
      });
    </script>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<script>

  
  const options = {
  root: null,
  rootMargin: '150px',
  threshold: 0
};

function callback(entries, observer) {
  //console.log('callback');
  //console.log(observer);
  entries.forEach(entry => {
    //console.log(entry);
    if (entry.isIntersecting) {
      console.log('ok ', entry.target);
      adHandler.cmd.push(function(){
        adHandler.setContext({'url':'article2'});
      });
      observer.unobserve(entry.target);
    } else {
      //console.log('** ', entry.target);
    }
  });
}

let observer = new IntersectionObserver(callback, options);
observer.observe(document.getElementById('changectx'));
//observer.observe(document.getElementById('test2'));
//observer.observe(document.getElementById('test3'));
</script>

<script>
//setTimeout(function(){
  loadScript("//biddr.brealtime.com/35286717-1303.js",function(){
  console.log('biddr loaded');
  var e=window.googletag||{};
			e.cmd=e.cmd||[],e.cmd.push(function(){
					/*e.pubads().enableSingleRequest();
          e.pubads().disableInitialLoad();
          e.pubads().collapseEmptyDivs(true);
          e.enableServices()*/
          //window.googletag=e;
			});
      let int = setInterval(function(){
    if(window.googletag && googletag.pubadsReady) {
      console.log('googletag ready');
      clearInterval(int);
      adHandler.init(window.googletag, googletag.pubads());
    } else {
      console.log('googletag not ready');
    }
  },300);
});
//},3000);




function loadScript(src, callback) {
  var s,r,t;
  r = false;
  s = document.createElement('script');
  s.type = 'text/javascript';
  s.src = src;
  s.async = "async";
  s.onload = s.onreadystatechange = function() {
    //console.log( this.readyState ); //uncomment this line to see which ready states are called.
    if ( !r && (!this.readyState || this.readyState == 'complete') ) {
      r = true;
      if (typeof callback === 'function') {
      callback();
      }
    }
  };
  t = document.getElementsByTagName('script')[0];
  t.parentNode.insertBefore(s, t);
};
</script>

<script src="../framework.js"></script>
</body>
</html>
